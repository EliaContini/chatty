//>>built
define("dijit/Editor","require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),function(w,m,r,x,y,z,t,u,q,c,h,f,A,B,J,C,D,E,F,n,
G,v,g,H,I){function e(a){return new n({command:a.name})}function p(a){return new n({buttonClass:F,command:a.name})}r=r("dijit.Editor",H,{plugins:null,extraPlugins:null,constructor:function(){h.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",G]);this._plugins=[];this._editInterval=1E3*this.editActionInterval;
if(f("ie")||f("trident")||f("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new x;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);h.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=y.getLocalization("dijit._editor","commands",this.lang);f("webkit")&&q.set(this.domNode,
"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new C({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));m.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);t.add(this.iframe.parentNode,"dijitEditorIFrameContainer");t.add(this.iframe,"dijitEditorIFrame");z.set(this.iframe,"allowTransparency",!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},
destroy:function(){m.forEach(this._plugins,function(a){a&&a.destroy&&a.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(a,b){var d=h.isString(a)?{name:a}:h.isFunction(a)?{ctor:a}:a;if(!d.setEditor){var k={args:d,plugin:null,editor:this};d.name&&(n.registry[d.name]?k.plugin=n.registry[d.name](d):B.publish(I._scopeName+".Editor.getPlugin",k));if(!k.plugin)try{var c=d.ctor||h.getObject(d.name)||w(d.name);c&&(k.plugin=new c(d))}catch(l){throw Error(this.id+
": cannot find plugin ["+d.name+"]");}if(!k.plugin)throw Error(this.id+": cannot find plugin ["+d.name+"]");a=k.plugin}1<arguments.length?this._plugins[b]=a:this._plugins.push(a);a.setEditor(this);h.isFunction(a.setToolbar)&&a.setToolbar(this.toolbar)},resize:function(a){a&&E.prototype.resize.apply(this,arguments)},layout:function(){var a=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+u.getPadBorderExtents(this.iframe.parentNode).h+u.getMarginExtents(this.iframe.parentNode).h);
this.editingArea.style.height=a+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(a){var b,d=this.document.body,k=d.clientWidth,c=d.clientHeight,e=d.clientLeft,f=d.offsetWidth,g=d.offsetHeight,h=d.offsetLeft;/^rtl$/i.test(d.dir||"")?k<f&&a.x>k&&a.x<f&&(b=!0):a.x<e&&a.x>h&&(b=!0);b||c<g&&a.y>c&&a.y<g&&(b=!0);b||(delete this._cursorToStart,delete this._savedSelection,"BODY"==a.target.tagName&&this.defer("placeCursorAtEnd"),this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},
onBeforeDeactivate:function(a){this.customUndo&&this.endEditing(!0);"BODY"!=a.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(a){this._inEditing||(this._inEditing=!0,this._beginEditing(a));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(a){if(!this.customUndo||"undo"!=a&&"redo"!=a){this.customUndo&&(this.endEditing(),this._beginEditing());
var b=this.inherited(arguments);this.customUndo&&this._endEditing();return b}return this[a]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(a){try{var b=this.document.execCommand(a,!1,null);if(f("webkit")&&!b)throw{};}catch(d){b=A.substitute,alert(b(this.commands.systemShortcut,[this.commands[a],b(this.commands[f("mac")?"appleKey":"ctrlKey"],
[{cut:"X",copy:"C",paste:"V"}[a]])])),b=!1}return b},queryCommandEnabled:function(a){return!this.customUndo||"undo"!=a&&"redo"!=a?this.inherited(arguments):"undo"==a?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(a){var b=a.mark,d=a.mark;a=a.isCollapsed;var c;if(d)if(9>f("ie")||9===f("ie")&&f("quirks"))if(h.isArray(d))b=[],m.forEach(d,function(a){b.push(g.getNode(a,this.editNode))},this),this.selection.moveToBookmark({mark:b,isCollapsed:a});else{if(d.startContainer&&d.endContainer&&
(c=g.getSelection(this.window))&&c.removeAllRanges){c.removeAllRanges();a=g.create(this.window);var e=g.getNode(d.startContainer,this.editNode);var l=g.getNode(d.endContainer,this.editNode);e&&l&&(a.setStart(e,d.startOffset),a.setEnd(l,d.endOffset),c.addRange(a))}}else(c=g.getSelection(this.window))&&c.removeAllRanges&&(c.removeAllRanges(),a=g.create(this.window),e=g.getNode(d.startContainer,this.editNode),l=g.getNode(d.endContainer,this.editNode),e&&l&&(a.setStart(e,d.startOffset),a.setEnd(l,d.endOffset),
c.addRange(a)))},_changeToStep:function(a,b){this.setValue(b.text);(a=b.bookmark)&&this._moveToBookmark(a)},undo:function(){var a=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var b=this._steps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(b,this._steps[this._steps.length-1]),this._undoedSteps.push(b),this.onDisplayChanged(),delete this._undoRedoActive,a=!0);delete this._undoRedoActive}return a},redo:function(){var a=!1;if(!this._undoRedoActive){this._undoRedoActive=
!0;this.endEditing(!0);var b=this._undoedSteps.pop();b&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],b),this._steps.push(b),this.onDisplayChanged(),a=!0);delete this._undoRedoActive}return a},endEditing:function(a){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(a),this._inEditing=!1)},_getBookmark:function(){var a=this.selection.getBookmark(),b=[];if(a&&a.mark){var d=a.mark;if(9>f("ie")||9===f("ie")&&f("quirks")){var c=
g.getSelection(this.window);if(h.isArray(d))m.forEach(a.mark,function(a){b.push(g.getIndex(a,this.editNode).o)},this),a.mark=b;else if(c){var e;c.rangeCount&&(e=c.getRangeAt(0));a.mark=e?e.cloneRange():this.selection.getBookmark()}}try{a.mark&&a.mark.startContainer&&(b=g.getIndex(a.mark.startContainer,this.editNode).o,a.mark={startContainer:b,startOffset:a.mark.startOffset,endContainer:a.mark.endContainer===a.mark.startContainer?b:g.getIndex(a.mark.endContainer,this.editNode).o,endOffset:a.mark.endOffset})}catch(l){a.mark=
null}}return a},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:v.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var a=v.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:a,bookmark:this._getBookmark()})},onKeyDown:function(a){f("ie")||this.iframe||a.keyCode!=c.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var b=a.keyCode;if(a.ctrlKey&&!a.shiftKey&&!a.altKey){if(90==b||122==b){a.stopPropagation();
a.preventDefault();this.undo();return}if(89==b||121==b){a.stopPropagation();a.preventDefault();this.redo();return}}this.inherited(arguments);switch(b){case c.ENTER:case c.BACKSPACE:case c.DELETE:this.beginEditing();break;case 88:case 86:if(a.ctrlKey&&!a.altKey&&!a.metaKey){this.endEditing();88==a.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!a.ctrlKey&&!a.altKey&&!a.metaKey&&(a.keyCode<c.F1||a.keyCode>c.F15)){this.beginEditing();break}case c.ALT:this.endEditing();
break;case c.UP_ARROW:case c.DOWN_ARROW:case c.LEFT_ARROW:case c.RIGHT_ARROW:case c.HOME:case c.END:case c.PAGE_UP:case c.PAGE_DOWN:this.endEditing(!0);case c.CTRL:case c.SHIFT:case c.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(a){}},_restoreSelection:function(){this._savedSelection&&(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),
delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(a){this.customUndo?this.isClosed?this.setValue(a):(this.beginEditing(),a||(a="\x26#160;"),this.setValue(a),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(a){this.setValueDeferred.then(h.hitch(this,function(){!this.disabled&&a||!this._buttonEnabledPlugins&&a?m.forEach(this._plugins,function(a){a.set("disabled",!0)}):this.disabled&&!a&&m.forEach(this._plugins,
function(a){a.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(q.set(this.document.body,"color",q.get(this.iframe,"color")),q.set(this.document.body,"background-color",q.get(this.iframe,"background-color")))}catch(a){}}});h.mixin(n.registry,{undo:e,redo:e,cut:e,copy:e,paste:e,insertOrderedList:e,insertUnorderedList:e,indent:e,outdent:e,justifyCenter:e,justifyFull:e,justifyLeft:e,justifyRight:e,"delete":e,
selectAll:e,removeFormat:e,unlink:e,insertHorizontalRule:e,bold:p,italic:p,underline:p,strikethrough:p,subscript:p,superscript:p,"|":function(){return new n({setEditor:function(a){this.editor=a;this.button=new D({ownerDocument:a.ownerDocument})}})}});return r});
//# sourceMappingURL=Editor.js.map