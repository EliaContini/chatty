//>>built
define("app/Storage",["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/request"],function(g,b,h,f){return g([h],{lastTimestamp:null,nickname:null,token:"d7a57e6adf3ac3dc9c0abcf18234a66d",endpoint:"https://chatty.kubernetes.doodle-test.com/api/chatty/v1.0/",refreshInterval:500,_lastMessages:null,_observers:[],boot:function(){setInterval(b.hitch(this,"getMessages"),this.refreshInterval)},getMessages:function(){var a=this.endpoint,e={token:this.token};null!=this.lastTimestamp&&(e.since=this.lastTimestamp);
return f.get(a,{handleAs:"json",headers:{"X-Requested-With":null},query:e,preventCache:!0}).then(b.hitch(this,"_getMessagesPrepareData")).then(b.hitch(this,"_notifyObservers"))},observe:function(a){this._observers.push(a)},sendMessage:function(a){return f.post(this.endpoint,{data:JSON.stringify({author:this.nickname,message:a.message}),handleAs:"json",headers:{"Content-Type":"application/json","X-Requested-With":null,token:this.token},preventCache:!0}).then(b.hitch(this,"_sendMessagePrepareData")).then(b.hitch(this,
"getMessages"))},_getMessagesPrepareData:function(a){a=[{author:"Elia",message:"for me too",timestamp:159566699E4},{author:"Alice",message:"yes",timestamp:159566688E4},{author:"Bob",message:"is it OK for you?",timestamp:159566677E4},{author:"Bob",message:"hola",timestamp:159566666E4},{author:"Bob",message:"ciao",timestamp:159566655E4},{author:"Bob",message:"hello",timestamp:159566644E4}];for(var e=this.nickname,c=null,d=0,b=a.length;d<b;d++)c=a[d],a[d].isMe=c.author===e?!0:!1;0<a.length&&(this.lastTimestamp=
a[0].timestamp);return this._lastMessages=a},_notifyObservers:function(){for(var a=this._observers,b=this._lastMessages,c=0,d=a.length;c<d;c++)a[c](b)},_sendMessagePrepareData:function(a){return a}})});
//# sourceMappingURL=Storage.js.map